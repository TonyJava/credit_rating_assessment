# 用户信用等级评定系统

### 需求描述

为优化运营，对使用本业务的全网用户进行积分、经验值、结合安全策略进行信用等级的划分，根据用户的信用等级进行营销策略的权益分配，如抽奖活动，信用等级越高的用户，中奖的几率越高。发送优惠券优先发送信用等级高的用户。以便达到优质用户在平台不流失。

* 积分：积分可以享有某些权益（不同的应用有不同的权益，如兑换优惠券，兑换抽奖次数，下载资料，兑换装备等等）
* 经验值等级：基于用户活跃行为，经验值可以兑换积分，已兑换经验值不能再次兑换
* 安全等级：触发安全策略，被处理的用户
* 信用等级：通过经验值+安全等级，计算用户的信用等级，通过用户信用等级筛选优质用户，推送营销策略。



### 相关技术

**项目构建：** sbt-1.2.7

**相关组件：** 

* SparkStream：实时计算用户的经验及积分
* Redis：缓存用户信息
* Kafka：存储用户操作记录的中间件
* Sqoop: 定时增量导出操作记录
* Hive：离线分析
* MySQL：存储业务数据及分析结果



### 详细设计

**1. 积分计算规则**

| 行为                           | 类型（OprType） | 值                 |
| ------------------------------ | --------------- | ------------------ |
| 登录                           | 1               | 0.5                |
| 互动行为（点赞，下载，评论等） | 2               | 每个行为0.1        |
| 邀请好友注册                   | 3               | +1                 |
| 分享链接                       | 4               | +1                 |
| 好友数量+1                     | 5               | +1                 |
| 首次开通会员                   | 6               | 50                 |
| 保持会员资源                   | 7               | 每月25             |
| 签到                           | 8               | +1，当天重复不计算 |
| 月费会员1.1倍增长              |                 |                    |
| 年费会员1.2倍增长              |                 |                    |


**2. 用户经验值**

按每小时1个经验值；用户签到经验值+1，连续签到，经验值为昨日签到经验值的翻倍，中断后重新开始累积。

| 等级 | 经验值      |
| ---- | ----------- |
| 1级  | 经验值150   |
| 2级  | 经验值400   |
| 3级  | 经验值1200  |
| 4级  | 经验值2400  |
| 5级  | 经验值4000  |
| 6级  | 经验值6000  |
| 7级  | 经验值9750  |
| 8级  | 经验值18000 |
| 9级  | 经验值28750 |

**3. 信用评分**

根据用户的经验值和安全策略的处理次数，计算信用等级

$$ 信用评分 = 经验值 * [1 - (\alpha * 安全策略处理次数权重系数)] $$

通过对安全指标各维度进行分析，设置权重系数 $\alpha = 0.6$ 。



安全策略处理次数权重系数分布表

| 安全策略处理次数 | 安全策略处理次数权重系数 |
| ---------------- | ------------------------ |
| 1次              | 0.0                      |
| 2次              | 0.6                      |
| >=3次            | 1.0                      |

信用等级表

| **信用等级** | **经验等级** | **信用/经验等级对应的分数** |
| ------------ | ------------ | --------------------------- |
| 等级I级      | 0级-1级      | [0-10]分                    |
| 等级H级      | 2级-3级      | (10-20]分                   |
| 等级G级      | 4级-5级      | (20-30]分                   |
| 等级F级      | 6级-7级      | (30-40]分                   |
| 等级E级      | 8级-9级      | (40-50]分                   |
| 等级D级      | 10级-12级    | (50-60]分                   |
| 等级C级      | 13级-17级    | (60-80]分                   |
| 等级B级      | 18级-22级    | (80-100]分                  |
| 等级A级      | 23级及以上   | 100分                       |

**4. 计算周期**

* **实时**：经验值、积分：通过Spark Streaming实时计算
* **月**：每月初统计上月累计积分、信用等级
* **年**：每年初统计去年累计积分

